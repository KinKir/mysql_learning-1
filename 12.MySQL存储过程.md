# MySQL存储过程
## 临时表
```
//该语句创建的临时表 是基于会话的。每个会话都可以创建临时表，不同的会话可以创建同一个名字的临时表。

mysql> create temporary table c (a int );
Query OK, 0 rows affected (0.10 sec)

mysql> show tables;
+----------------+
| Tables_in_test |
+----------------+
| a              |
| t              |
+----------------+

// innodb表 并不是内存表，和执行sql产生的临时表是不同的，执行sql产生的临时表默认是内存的，tmp_table_size 存不下 才会刷到磁盘。

mysql> show create table c;
+-------+----------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                 |
+-------+----------------------------------------------------------------------------------------------+
| c     | CREATE TEMPORARY TABLE `c` (
  `a` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 |
+-------+----------------------------------------------------------------------------------------------+
1 row in set (0.01 sec)

//那这张表 到底在哪儿呢？  进入DATADIR目录 可以看到 ibtmp1这个文件。这个文件就是临时表空间。在临时表里插入的数据内容 都会存储在这个临时表空间里。

//那么问题来了？表结构在哪儿呢？
mysql> insert into c values (1);
Query OK, 1 row affected (0.01 sec)


mysql> show variables like 'tmp%';
+----------------+---------------------------------------------------+
| Variable_name  | Value                                             |
+----------------+---------------------------------------------------+
| tmp_table_size | 16777216                                          |
| tmpdir         | /var/folders/1j/5mm0zvks0gs2nlxrx68mjtd00000gn/T/ |
+----------------+---------------------------------------------------+
2 rows in set (0.04 sec)


//临时目录里 .frm就是临时表的结构定义文件
➜  cd /var/folders/1j/5mm0zvks0gs2nlxrx68mjtd00000gn/T/

//这两个文件是可以通过 mysqlfrm 来解析的。

➜  T ll *.frm
-rw-r-----  1 ShaoGaoJie  staff  8554  1  3 23:15 #sqlf9fc_29_10.frm
-rw-r-----  1 ShaoGaoJie  staff  8554  1  3 23:07 #sqlf9fc_29_d.frm

# 上面演示的是5.7的临时表特质。

# 下面看看 5.6 的临时表
mysql> select version();
+-----------+
| version() |
+-----------+
| 5.6.38    |
+-----------+
1 row in set (0.00 sec)

mysql> create temporary table c (a int);
Query OK, 0 rows affected (0.05 sec)

查看datadir下 没有ibtmp1类似的文件。
mysql> show variables like 'tmp%';
+----------------+---------------------------------------------------+
| Variable_name  | Value                                             |
+----------------+---------------------------------------------------+
| tmp_table_size | 16777216                                          |
| tmpdir         | /var/folders/1j/5mm0zvks0gs2nlxrx68mjtd00000gn/T/ |
+----------------+---------------------------------------------------+
2 rows in set (0.01 sec)

// 5.6里面没有临时表空间文件。所有的内容都存放在tmpdir目录下。如果tmpdir目录不是足够大，那么就有可能报错。
-rw-rw----  1 ShaoGaoJie  staff   8554  1  3 23:24 #sql2b4e_a_3.frm
-rw-rw----  1 ShaoGaoJie  staff  98304  1  3 23:24 #sql2b4e_a_3.ibd

所以，建议将tmpdir 放到datadir下，以免空间不够用。

```

## 存储过程
1. 存储在数据库端的一组SQL语句集合
2. 用户可以通过存储过程名称和传参多次调用的程序模块
3. 特点
	1. 使用灵活，可以使用流控制语句、自定义变量等完成复杂的业务逻辑
	2. 提高数据安全性，屏蔽应用程序直接对表的操作，易于进行审计
	3. 减少网络传输
	4. 提高代码维护的复杂度，实际使用中要评估使用场景是否合适

	！！！！！！ 一般不用哈哈哈哈 ！！！！！！！性能并不好。
