# MySQL 复合索引

```

(root@localhost)[test]> create table t1 (a int,b int);
Query OK, 0 rows affected (0.09 sec)
//创建一个复合索引(a,b);
(root@localhost)[test]> alter table t1 add index idx_a_b(a,b);
Query OK, 0 rows affected (0.05 sec)
Records: 0  Duplicates: 0  Warnings: 0

(root@localhost)[test]> show create table t1;
+-------+--------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                               |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------+
| t1    | CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  KEY `idx_a_b` (`a`,`b`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)
```

### 举例分析
```
show create table lineitem;
CREATE TABLE `lineitem` (
  `l_orderkey` int(11) NOT NULL,
  `l_partkey` int(11) DEFAULT NULL,
  `l_suppkey` int(11) DEFAULT NULL,
  `l_linenumber` int(11) NOT NULL,
  `l_quantity` double DEFAULT NULL,
  `l_extendedprice` double DEFAULT NULL,
  `l_discount` double DEFAULT NULL,
  `l_tax` double DEFAULT NULL,
  `l_returnflag` char(1) DEFAULT NULL,
  `l_linestatus` char(1) DEFAULT NULL,
  `l_shipDATE` date DEFAULT NULL,
  `l_commitDATE` date DEFAULT NULL,
  `l_receiptDATE` date DEFAULT NULL,
  `l_shipinstruct` char(25) DEFAULT NULL,
  `l_shipmode` char(10) DEFAULT NULL,
  `l_comment` varchar(44) DEFAULT NULL,
  PRIMARY KEY (`l_orderkey`,`l_linenumber`),
  KEY `i_l_shipdate` (`l_shipDATE`),
  KEY `i_l_suppkey_partkey` (`l_partkey`,`l_suppkey`),
  KEY `i_l_partkey` (`l_partkey`),
  KEY `i_l_suppkey` (`l_suppkey`),
  KEY `i_l_receiptdate` (`l_receiptDATE`),
  KEY `i_l_orderkey` (`l_orderkey`),
  KEY `i_l_orderkey_quantity` (`l_orderkey`,`l_quantity`),//复合索引
  KEY `i_l_commitdate` (`l_commitDATE`),
  CONSTRAINT `_lineitem_ibfk_1` FOREIGN KEY (`l_orderkey`) REFERENCES `orders` (`o_orderkey`),
  CONSTRAINT `lineitem_ibfk_2` FOREIGN KEY (`l_partkey`, `l_suppkey`) REFERENCES `partsupp` (`ps_partkey`, `ps_suppkey`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1

//查看这个复合索引的元数据

(root@localhost)[employees]> use information_schema;
(root@localhost)[employees]> select * from STATISTICS where index_name  = 'i_l_orderkey_quantity' and table_name  = 'lineitem' and INDEX_SCHEMA = 'dbt3'\G
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
*************************** 1. row ***************************
TABLE_CATALOG: def
 TABLE_SCHEMA: dbt3
   TABLE_NAME: lineitem
   NON_UNIQUE: 1
 INDEX_SCHEMA: dbt3
   INDEX_NAME: i_l_orderkey_quantity
 SEQ_IN_INDEX: 1-------------------------------------复合索引的第一个列
  COLUMN_NAME: l_orderkey
    COLLATION: A
  CARDINALITY: 1367228-------------------------------复合索引第一个列的CARDINALITY
     SUB_PART: NULL
       PACKED: NULL
     NULLABLE:
   INDEX_TYPE: BTREE
      COMMENT:
INDEX_COMMENT:
*************************** 2. row ***************************
TABLE_CATALOG: def
 TABLE_SCHEMA: dbt3
   TABLE_NAME: lineitem
   NON_UNIQUE: 1
 INDEX_SCHEMA: dbt3
   INDEX_NAME: i_l_orderkey_quantity
 SEQ_IN_INDEX: 2------------------------------------复合索引的两个列（！！！不是第二个列！！！！！）
  COLUMN_NAME: l_quantity
    COLLATION: A
  CARDINALITY: 5265035---------------复合索引组合起来的CARDINALITY值
     SUB_PART: NULL
       PACKED: NULL
     NULLABLE: YES
   INDEX_TYPE: BTREE
      COMMENT:
INDEX_COMMENT:
2 rows in set (0.01 sec)

(root@localhost)[information_schema]>
```

### 冗余索引 sys.schema\_redundant_indexes
```
(root@localhost)[sys]> use sys;select * from schema_redundant_indexes limit 1\G
Database changed
*************************** 1. row ***************************
              table_schema: dbt3
                table_name: lineitem
      redundant_index_name: i_l_orderkey
   redundant_index_columns: l_orderkey---------------------- 冗余索引
redundant_index_non_unique: 1
       dominant_index_name: i_l_orderkey_quantity
    dominant_index_columns: l_orderkey,l_quantity
 dominant_index_non_unique: 1
            subpart_exists: 0
            sql_drop_index: ALTER TABLE `dbt3`.`lineitem` DROP INDEX `i_l_orderkey`--------------------删除索引的SQL 建议执行
1 row in set (0.01 sec)

```